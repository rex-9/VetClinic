-- Day 1
CREATE TABLE pets(
  id INT GENERATED BY DEFAULT AS IDENTITY,
  name VARCHAR(16),
  birth_date date,
  escape_attempts INT,
  neutered bool,
  weight_kg DECIMAL,
  PRIMARY KEY(id)
);

-- Day 2
ALTER TABLE pets
ADD species VARCHAR(12);

-- Day 3
CREATE TABLE owners(
  id	INT GENERATED BY DEFAULT AS IDENTITY,
	full_name	VARCHAR,
	age	INT,
	PRIMARY KEY (id)
); -- Owners table

CREATE TABLE species (
	id INT GENERATED BY DEFAULT AS IDENTITY,
	name	VARCHAR,
	PRIMARY KEY (id)
); -- Species table

ALTER TABLE pets
DROP COLUMN species; -- Remove species column from pets table

ALTER TABLE pets
ADD species_id INTEGER REFERENCES species (id) -- Add species_id column to pets table

ALTER TABLE pets
ADD owner_id INTEGER REFERENCES owners (id) -- Add owner_id column to pets table

ALTER TABLE pets
ADD CONSTRAINT fk_pets_species
FOREIGN KEY (species_id) REFERENCES species (id); -- Add species_id foreign key to pets table

ALTER TABLE pets
ADD CONSTRAINT fk_pets_owners
FOREIGN KEY (owner_id)
REFERENCES owners (id); -- Add owner_id foreign key constraint to pets table

-- Day 4
CREATE TABLE vets (
	id INT GENERATED BY DEFAULT AS IDENTITY,
	name VARCHAR,
	age INT,
	graduation_date date,
	PRIMARY KEY (id)
); -- Create vets table

CREATE TABLE specializations (
	vet_id INT,
	species_id INT,
	PRIMARY KEY (vet_id, species_id),
	FOREIGN KEY (vet_id) REFERENCES vets (id),
	FOREIGN KEY (species_id) REFERENCES species (id)
); -- Create specializations join table

CREATE TABLE visits (
	vet_id INT,
	pet_id INT,
  visit_date date,
	PRIMARY KEY (vet_id, pet_id, visit_date),
	FOREIGN KEY (vet_id) REFERENCES vets (id),
	FOREIGN KEY (pet_id) REFERENCES pets (id)
); -- Create visits join table

-- Day 5

-- Add an email column to your owners table
ALTER TABLE owners ADD COLUMN email VARCHAR(120);

ALTER TABLE visits DROP CONSTRAINT visits_pkey; -- Drop primary key constraint from visits table

-- This will add 3.594.280 visits considering you have 10 animals, 4 vets, and it will use around ~87.000 timestamps (~4min approx.)
INSERT INTO visits (pet_id, vet_id, visit_date) SELECT * FROM (SELECT id FROM pets) pet_ids, (SELECT id FROM vets) vet_ids, generate_series('1980-01-01'::timestamp, '2021-01-01', '4 hours') visit_timestamp;

ALTER TABLE owners DROP CONSTRAINT owners_pkey CASCADE; -- Drop primary key constraint from owners table

-- This will add 2.500.000 owners with full_name = 'Owner <X>' and email = 'owner_<X>@email.com' (~2min approx.)
INSERT INTO owners (full_name, email) SELECT 'Owner ' || generate_series(1,2500000), 'owner_' || generate_series(1,2500000) || '@mail.com';
